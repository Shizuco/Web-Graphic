<!DOCTYPE html>
<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>03.10 - Помічник SpotLightHelper </title>
	<script src="./js/three.min.js"></script>
	<script src="./js/OrbitControls.js"></script>



</head>

<body>

	<script>


		init();

		function init() {

			// створюємо рендер і задаємо розмір
			var renderer = window.WebGLRenderingContext ? new THREE.WebGLRenderer({ antialias: true }) : new THREE.CanvasRenderer();
			renderer.setClearColor(new THREE.Color(0xEEEEEE));
			renderer.setSize(window.innerWidth, window.innerHeight);

			renderer.shadowMapSoft = true;
			renderer.shadowMap.enabled = true;
			renderer.shadowMap.type = THREE.PCFSoftShadowMap;

			// додаємо вивід візуалізатора до html-елементу
			document.body.appendChild(renderer.domElement);

			// створюємо сцену, яка буде містити всі наші елементи, такі як об'єкти, камери і джерела світла
			var scene = new THREE.Scene();

			// створюємо камеру
			var camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 1, 10000);


			camera.position.set(-1200, 600, 1600);
			camera.lookAt(new THREE.Vector3(0, 0, 0));

			var controls = new THREE.OrbitControls(camera, renderer.domElement);
			controls.target = new THREE.Vector3(0, 0, 0);

			// завантажити текстуру
			var texture = THREE.ImageUtils.loadTexture('./images/texture1.png');
			texture.repeat.set(10, 10);
			texture.wrapS = texture.wrapT = THREE.RepeatWrapping;
			texture.anisotropy = 16;
			texture.needsUpdate = true;

			var textureBump = THREE.ImageUtils.loadTexture('./images/bump1.jpg');
			textureBump.repeat.set(10, 10);
			textureBump.wrapS = textureBump.wrapT = THREE.RepeatWrapping;
			textureBump.anisotropy = 16;
			textureBump.needsUpdate = true;

			// підготувати годинник
			var clock = new THREE.Clock();
			// spot light - світло випромінюється з однієї точки в одному напрямку, 
			// вздовж конуса, розмір якого збільшується в міру віддалення від джерела світла.
			var spotLight = new THREE.SpotLight(0xffffff);
			spotLight.position.set(-200, 500, 400);
			spotLight.castShadow = true;
			spotLight.shadowMapWidth = spotLight.shadowMapHeight = 2000;

			var d = 500;

			spotLight.shadow.camera.left = d;
			spotLight.shadow.camera.right = -d;
			spotLight.shadow.camera.top = -d;
			spotLight.shadow.camera.bottom = d;

			spotLight.shadow.camera.far = 1000;
			spotLight.shadow.bias = - 0.0001;
			scene.add(spotLight);





			// додати площину
			var plane_Geometry = new THREE.PlaneGeometry(1200, 1200, 1, 1);
			plane = new THREE.Mesh(plane_Geometry, new THREE.MeshLambertMaterial({ color: 0x9669FE }));
			plane.position.y = -20;
			plane.rotation.x = - Math.PI / 2;
			plane.receiveShadow = true;
			scene.add(plane);

			// створити new group (Object3D)
			var group = new THREE.Object3D();

			// додати дві сфери

			var cone = drawCone(-100, 150, new THREE.MeshPhongMaterial({ map: texture, bumpMap: textureBump, color: 0x00ff00, specular: 0xff2200, emissive: 0x004000 }));
			var cone2 = drawCone(100, 150, new THREE.MeshPhongMaterial({ map: texture, bumpMap: textureBump, color: 0x00ff00, specular: 0xff2200, shininess: 3 }));

			//.. і додати їх до групи
			group.add(cone);
			group.add(cone2);

			scene.add(group);


			// add helpers:

			// SpotLightHelper
			var spotLightHelper = new THREE.SpotLightHelper(spotLight, 10); // 10 is sphere size
			scene.add(spotLightHelper);

			function drawCone(x, z, material) {
				var cone = new THREE.Mesh(new THREE.ConeGeometry(70, 70, 20), material);
				cone.rotation.x = cone.rotation.z = Math.PI * Math.random();
				cone.position.x = x;
				cone.position.y = 100;
				cone.position.z = z;
				cone.castShadow = cone.receiveShadow = true;

				return cone;
			}
			renderScene();

			function renderScene() {

				requestAnimationFrame(renderScene);
				controls.update(clock.getDelta());


				renderer.render(scene, camera);
			}


		};


	</script>
</body>

</html>